<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Create a new type to represent an Objective-C class."><title>extern_class in objc2 - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="objc2" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0 (82e1608df 2023-12-21)" data-channel="1.75.0" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-9dd44ab47b99a0fb.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../objc2/index.html">objc2</a><span class="version">0.3.0-beta.5</span></h2></div><div class="sidebar-elems"></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Macro <a href="index.html">objc2</a>::<wbr><a class="macro" href="#">extern_class</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/objc2/macros/extern_class.rs.html#134-202">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><span class="macro">macro_rules! </span>extern_class {
    (
        $(<span class="attr">#[<span class="macro-nonterminal">$m</span>:meta]</span>)*
        <span class="macro-nonterminal">$v</span>:vis <span class="kw">struct </span><span class="macro-nonterminal">$name</span>:ident;

        $(<span class="attr">#[<span class="macro-nonterminal">$impl_m</span>:meta]</span>)*
        <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span><span class="macro-nonterminal">$</span><span class="kw">for</span>:<span class="macro-nonterminal">ty </span>{
            $(<span class="attr">#[inherits($(<span class="macro-nonterminal">$inheritance_rest</span>:ty),+)]</span>)<span class="question-mark">?
            </span><span class="kw">type </span>Super = <span class="macro-nonterminal">$superclass</span>:ty;

            $(<span class="kw">const </span>NAME: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str = <span class="macro-nonterminal">$name_const</span>:literal;)<span class="question-mark">?
        </span>}
    ) =&gt; { ... };
    (
        $(<span class="attr">#[<span class="macro-nonterminal">$m</span>:meta]</span>)*
        <span class="macro-nonterminal">$v</span>:vis <span class="kw">struct </span><span class="macro-nonterminal">$name</span>:ident {
            $(<span class="macro-nonterminal">$field_vis</span>:vis <span class="macro-nonterminal">$field</span>:ident: <span class="macro-nonterminal">$field_ty</span>:ty,)*
        }

        $(<span class="attr">#[<span class="macro-nonterminal">$impl_m</span>:meta]</span>)*
        <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span><span class="macro-nonterminal">$</span><span class="kw">for</span>:<span class="macro-nonterminal">ty </span>{
            $(<span class="attr">#[inherits($(<span class="macro-nonterminal">$inheritance_rest</span>:ty),+)]</span>)<span class="question-mark">?
            </span><span class="kw">type </span>Super = <span class="macro-nonterminal">$superclass</span>:ty;

            $(<span class="kw">const </span>NAME: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static </span>str = <span class="macro-nonterminal">$name_const</span>:literal;)<span class="question-mark">?
        </span>}
    ) =&gt; { ... };
}</pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Create a new type to represent an Objective-C class.</p>
<p>This is similar to an <code>@interface</code> declaration in Objective-C.</p>
<p>The given struct name should correspond to a valid Objective-C class,
whose instances have the encoding <a href="encode/enum.Encoding.html#variant.Object" title="variant objc2::encode::Encoding::Object"><code>Encoding::Object</code></a>. (as an example:
<code>NSAutoreleasePool</code> does not have this!)</p>
<p>You must specify the superclass of this class, similar to how you would
in Objective-C.</p>
<p>Due to Rust trait limitations, specifying e.g. the superclass <code>NSData</code>
would not give you easy access to <code>NSObject</code>’s functionality. Therefore,
you may specify additional parts of the inheritance chain using the
<code>#[inherits(...)]</code> attribute.</p>
<h2 id="specification"><a href="#specification">Specification</a></h2>
<p>The syntax is similar enough to Rust syntax that if you invoke the macro
with parentheses (as opposed to curly brackets), <a href="https://github.com/rust-lang/rustfmt/discussions/5437"><code>rustfmt</code> will be able to
format the contents</a>.</p>
<p>This creates an opaque struct containing the superclass (which means that
auto traits are inherited from the superclass), and implements the
following traits for it to allow easier usage as an Objective-C object:</p>
<ul>
<li><a href="encode/trait.RefEncode.html" title="trait objc2::encode::RefEncode"><code>RefEncode</code></a></li>
<li><a href="trait.Message.html" title="trait objc2::Message"><code>Message</code></a></li>
<li><a href="trait.ClassType.html" title="trait objc2::ClassType"><code>ClassType</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/ops/deref/trait.Deref.html" title="trait core::ops::deref::Deref"><code>Deref&lt;Target = $superclass&gt;</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/ops/deref/trait.DerefMut.html" title="trait core::ops::deref::DerefMut"><code>DerefMut</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/convert/trait.AsRef.html" title="trait core::convert::AsRef"><code>AsRef&lt;$inheritance_chain&gt;</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/convert/trait.AsMut.html" title="trait core::convert::AsMut"><code>AsMut&lt;$inheritance_chain&gt;</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/borrow/trait.Borrow.html" title="trait core::borrow::Borrow"><code>Borrow&lt;$inheritance_chain&gt;</code></a></li>
<li><a href="https://doc.rust-lang.org/1.75.0/core/borrow/trait.BorrowMut.html" title="trait core::borrow::BorrowMut"><code>BorrowMut&lt;$inheritance_chain&gt;</code></a></li>
</ul>
<p>The macro allows specifying fields on the struct, but <em>only</em> zero-sized
types like <a href="https://doc.rust-lang.org/1.75.0/core/marker/struct.PhantomData.html" title="struct core::marker::PhantomData"><code>PhantomData</code></a> and <a href="declare/struct.Ivar.html" title="struct objc2::declare::Ivar"><code>declare::Ivar</code></a> are allowed here!</p>
<p>You may add a <code>#[cfg(...)]</code> attribute to the class and <code>ClassType</code> impl,
and then it will work as expected. Only <code>#[cfg(...)]</code> attributes are
supported on the <code>ClassType</code> impl!</p>
<h2 id="safety"><a href="#safety">Safety</a></h2>
<p>The specified superclass must be correct. The object must also respond to
standard memory management messages (this is upheld if <a href="runtime/struct.NSObject.html" title="struct objc2::runtime::NSObject"><code>NSObject</code></a> is
part of its inheritance chain).</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<p>Create a new type to represent the <code>NSFormatter</code> class.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::rc::{Id, Shared};
<span class="kw">use </span>objc2::{ClassType, extern_class, msg_send_id};

<span class="macro">extern_class!</span>(
    <span class="doccomment">/// An example description.
    </span><span class="attr">#[derive(PartialEq, Eq, Hash)] </span><span class="comment">// Uses the superclass&#39; implementation
    // Specify the class and struct name to be used
    </span><span class="kw">pub struct </span>NSFormatter;

    <span class="comment">// Specify the superclass, in this case `NSObject`
    </span><span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>NSFormatter {
        <span class="kw">type </span>Super = NSObject;
        <span class="comment">// Optionally, specify the name of the class, if it differs from
        // the struct name.
        // const NAME: &amp;&#39;static str = &quot;NSFormatter&quot;;
    </span>}
);

<span class="comment">// We can specify the protocols that `NSFormatter` conforms to like this.
// (These should be created using the `extern_protocol!` macro).
//
// unsafe impl NSCoding for NSFormatter {}
// unsafe impl NSCopying for NSFormatter {}

// Provided by the implementation of `ClassType`
</span><span class="kw">let </span>cls = NSFormatter::class();

<span class="comment">// `NSFormatter` implements `Message`:
</span><span class="kw">let </span>obj: Id&lt;NSFormatter, Shared&gt; = <span class="kw">unsafe </span>{ <span class="macro">msg_send_id!</span>[cls, new] };</code></pre></div>
<p>Represent the <code>NSDateFormatter</code> class, using the <code>NSFormatter</code> type we
declared previously to specify as its superclass.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::{extern_class, ClassType};

<span class="macro">extern_class!</span>(
    <span class="attr">#[derive(PartialEq, Eq, Hash)]
    </span><span class="kw">pub struct </span>NSDateFormatter;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>NSDateFormatter {
        <span class="comment">// Specify the correct inheritance chain
        </span><span class="attr">#[inherits(NSObject)]
        </span><span class="kw">type </span>Super = NSFormatter;
    }
);

<span class="comment">// Similarly, we can specify the protocols that this implements here:
//
// unsafe impl NSCoding for NSFormatter {}
// unsafe impl NSCopying for NSFormatter {}</span></code></pre></div>
<p>See the source code of <code>icrate</code> for many more examples.</p>
</div></details></section></div></main></body></html>